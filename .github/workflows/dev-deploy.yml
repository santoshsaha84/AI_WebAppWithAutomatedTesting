name: Dev Build & Deploy

on:
  push:
    branches: [ "dev" ]
  workflow_dispatch:

jobs:
  test-and-deploy:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Setup .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: 7.0.x

    - name: Restore dependencies
      run: dotnet restore

    - name: Build
      run: dotnet build --no-restore

    - name: Run Unit Tests Only
      # skipping UI tests for now due to headless environment issues
      run: dotnet test src/BulkyBook.Tests/BulkyBook.Tests.csproj

    - name: Deploy to Render (Dev)
      if: success()
      run: |
        if [ -n "${{ secrets.RENDER_DEPLOY_HOOK_DEV }}" ]; then
          curl "${{ secrets.RENDER_DEPLOY_HOOK_DEV }}"
        else
          echo "Render Deploy Hook secret not found. Skipping deploy."
        fi
